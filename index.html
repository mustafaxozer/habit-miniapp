<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>WFX Coin Borsası</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    background-color: #0f0f0f;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 1rem;
  }
  canvas {
    max-width: 100%;
    margin: 1rem 0;
  }
  .balance {
    font-size: 1.5rem;
    margin-top: 1rem;
  }
  .info-box {
    background: #1a1a1a;
    padding: 1rem;
    border-radius: 10px;
    margin-top: 1rem;
  }
  .info-box p {
    margin: 0.3rem 0;
  }
</style>
</head>
<body>
  <h1>WFX Coin</h1>
  <p>Güncel Fiyat (TL): <span id="currentPrice">...</span></p>
  <canvas id="priceChart" width="400" height="200"></canvas>
  <div class="balance">
    Cüzdanınız: <span id="balance">315 WFX</span>
  </div>
  <div class="info-box">
    <p>Toplam Arz: <span id="supply">...</span></p>
    <p>Toplam Talep: <span id="demand">...</span></p>
    <p>Güncellenme Zamanı: <span id="lastUpdate">...</span></p>
  </div>

<script>
const apiUrl = 'http://localhost:3000/api/market'; // Backend URL

const ctx = document.getElementById('priceChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: 'WFX / TL',
      data: [],
      borderColor: '#00ff88',
      backgroundColor: 'rgba(0, 255, 136, 0.2)',
      tension: 0.2,
      fill: true,
    }]
  },
  options: {
    responsive: true,
    scales: { y: { beginAtZero: false } }
  }
});

function updateUI(marketData) {
  document.getElementById('currentPrice').textContent = marketData.history.length > 0 
    ? marketData.history[marketData.history.length-1].price : '...';
  document.getElementById('supply').textContent = marketData.supply;
  document.getElementById('demand').textContent = marketData.demand;
  document.getElementById('lastUpdate').textContent = marketData.history.length > 0 
    ? marketData.history[marketData.history.length-1].time : '...';
  document.getElementById('balance').textContent = '315 WFX'; // Sabit cüzdan

  chart.data.labels = marketData.history.map(h => h.time);
  chart.data.datasets[0].data = marketData.history.map(h => h.price);
  chart.update();
}

async function fetchMarketData() {
  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error('API error');
    const data = await res.json();
    updateUI(data);
  } catch(e) {
    console.error('Fetch error:', e);
  }
}

// İlk veri çekme ve sonra her 5 saniyede güncelle
fetchMarketData();
setInterval(fetchMarketData, 5000);
</script>
</body>
</html>
